var labyrinthe = [
  [
    "k",
    "f",
    "b",
    "f",
    "f",
    "f",
    "b",
    "f",
    "f",
    "o",
    "k",
    "f",
    "b",
    "f",
    "f",
    "f",
    "b",
    "f",
    "f",
    "o",
  ],
  [
    "e",
    "h",
    "g",
    "m",
    "b",
    "h",
    "g",
    "m",
    "f",
    "h",
    "k",
    "f",
    "b",
    "f",
    "f",
    "f",
    "b",
    "f",
    "f",
    "o",
  ],
  [
    "l",
    "g",
    "j",
    "f",
    "i",
    "g",
    "g",
    "k",
    "f",
    "i",
    "k",
    "f",
    "b",
    "f",
    "f",
    "f",
    "b",
    "f",
    "f",
    "o",
  ],
  [
    "n",
    "j",
    "f",
    "h",
    "k",
    "d",
    "a",
    "a",
    "f",
    "h",
    "k",
    "f",
    "b",
    "f",
    "f",
    "f",
    "b",
    "f",
    "f",
    "o",
  ],
  [
    "e",
    "f",
    "h",
    "j",
    "i",
    "m",
    "i",
    "g",
    "k",
    "i",
    "k",
    "f",
    "b",
    "f",
    "f",
    "f",
    "b",
    "f",
    "f",
    "o",
  ],
  [
    "g",
    "n",
    "j",
    "f",
    "b",
    "f",
    "f",
    "i",
    "j",
    "o",
    "k",
    "f",
    "b",
    "f",
    "f",
    "f",
    "b",
    "f",
    "f",
    "o",
  ],
  [
    "k",
    "f",
    "b",
    "f",
    "f",
    "f",
    "b",
    "f",
    "f",
    "o",
    "k",
    "f",
    "b",
    "f",
    "f",
    "f",
    "b",
    "f",
    "f",
    "o",
  ],
  [
    "e",
    "h",
    "g",
    "m",
    "b",
    "h",
    "g",
    "m",
    "f",
    "h",
    "k",
    "f",
    "b",
    "f",
    "f",
    "f",
    "b",
    "f",
    "f",
    "o",
  ],
  [
    "l",
    "g",
    "j",
    "f",
    "i",
    "g",
    "g",
    "k",
    "f",
    "i",
    "k",
    "f",
    "b",
    "f",
    "f",
    "f",
    "b",
    "f",
    "f",
    "o",
  ],
  [
    "n",
    "j",
    "f",
    "h",
    "k",
    "d",
    "a",
    "a",
    "f",
    "h",
    "k",
    "f",
    "b",
    "f",
    "f",
    "f",
    "b",
    "f",
    "f",
    "o",
  ],
  [
    "e",
    "f",
    "h",
    "j",
    "i",
    "m",
    "i",
    "g",
    "k",
    "i",
    "k",
    "f",
    "b",
    "f",
    "f",
    "f",
    "b",
    "f",
    "f",
    "o",
  ],
  [
    "g",
    "n",
    "j",
    "f",
    "b",
    "f",
    "f",
    "i",
    "j",
    "o",
    "k",
    "f",
    "b",
    "f",
    "f",
    "f",
    "b",
    "f",
    "f",
    "o",
  ],
  [
    "k",
    "f",
    "b",
    "f",
    "f",
    "f",
    "b",
    "f",
    "f",
    "o",
    "k",
    "f",
    "b",
    "f",
    "f",
    "f",
    "b",
    "f",
    "f",
    "o",
  ],
  [
    "e",
    "h",
    "g",
    "m",
    "b",
    "h",
    "g",
    "m",
    "f",
    "h",
    "k",
    "f",
    "b",
    "f",
    "f",
    "f",
    "b",
    "f",
    "f",
    "o",
  ],
  [
    "l",
    "g",
    "j",
    "f",
    "i",
    "g",
    "g",
    "k",
    "f",
    "i",
    "k",
    "f",
    "b",
    "f",
    "f",
    "f",
    "b",
    "f",
    "f",
    "o",
  ],
  [
    "n",
    "j",
    "f",
    "h",
    "k",
    "d",
    "a",
    "a",
    "f",
    "h",
    "k",
    "f",
    "b",
    "f",
    "f",
    "f",
    "b",
    "f",
    "f",
    "o",
  ],
  [
    "e",
    "f",
    "h",
    "j",
    "i",
    "m",
    "i",
    "g",
    "k",
    "i",
    "k",
    "f",
    "b",
    "f",
    "f",
    "f",
    "b",
    "f",
    "f",
    "o",
  ],
  [
    "g",
    "n",
    "j",
    "f",
    "b",
    "f",
    "f",
    "i",
    "j",
    "o",
    "k",
    "f",
    "b",
    "f",
    "f",
    "f",
    "b",
    "f",
    "f",
    "o",
  ],
  [
    "g",
    "n",
    "j",
    "f",
    "b",
    "f",
    "f",
    "i",
    "j",
    "o",
    "k",
    "f",
    "b",
    "f",
    "f",
    "f",
    "b",
    "f",
    "f",
    "o",
  ],
  [
    "g",
    "n",
    "j",
    "f",
    "b",
    "f",
    "f",
    "i",
    "j",
    "o",
    "k",
    "f",
    "b",
    "f",
    "f",
    "f",
    "b",
    "f",
    "f",
    "o",
  ],
];

var correspondance = {
  a: [0, 0, 0, 0],
  b: [1, 0, 0, 0],
  c: [0, 1, 0, 0],
  d: [0, 0, 1, 0],
  e: [0, 0, 0, 1],
  f: [1, 0, 1, 0],
  g: [0, 1, 0, 1],
  h: [1, 1, 0, 0],
  i: [0, 1, 1, 0],
  j: [0, 0, 1, 1],
  k: [1, 0, 0, 1],
  l: [0, 1, 1, 1],
  m: [1, 0, 1, 1],
  n: [1, 1, 0, 1],
  o: [1, 1, 1, 0],
};

var ListGuarde;

var Jungle = {
  W1: [
    "../images/mazes/jungle_maze_one_a.png",
    "../images/mazes/jungle_maze_one_b.png",
    "../images/mazes/jungle_maze_one_c.png",
    "../images/mazes/jungle_maze_one_d.png",
  ],
  W2: [
    "../images/mazes/jungle_maze_two_a.png",
    "../images/mazes/jungle_maze_two_b.png",
    "../images/mazes/jungle_maze_two_c.png",
    "../images/mazes/jungle_maze_two_d.png",
  ],
  W3: ["../images/mazes/jungle_maze_three.png"],
  W4: ["../images/mazes/jungle_maze_four_a.png"],
  B: [
    "../images/mazes/jungle_maze_border_a.png",
    "../images/mazes/jungle_maze_border_b.png",
    "../images/mazes/jungle_maze_border_c.png",
  ],
  Pl: "../images/heros/jungle_hero_gauche_sprite.png",
  Pr: "../images/heros/jungle_hero_droite_sprite.png",
};

var Retro = {
  W1: [
    "../images/mazes/retro_maze_one.png",
    "../images/mazes/retro_maze_one.png",
    "../images/mazes/retro_maze_one.png",
    "../images/mazes/retro_maze_one.png",
  ],
  W2: [
    "../images/mazes/retro_maze_two.png",
    "../images/mazes/retro_maze_two.png",
    "../images/mazes/retro_maze_two.png",
    "../images/mazes/retro_maze_two.png",
  ],
  W3: ["../images/mazes/retro_maze_three.png"],
  W4: ["../images/mazes/retro_maze_four.png"],
  B: [
    "../images/mazes/retro_maze_border.png",
    "../images/mazes/retro_maze_border.png",
    "../images/mazes/retro_maze_border.png",
  ],
  Pl: "../images/heros/jungle_hero_gauche_sprite.png",
  Pr: "../images/heros/jungle_hero_droite_sprite.png",
};

var Space = {
  W1: [
    "../images/mazes/space_maze_one_a.png",
    "../images/mazes/space_maze_one_b.png",
    "../images/mazes/space_maze_one_c.png",
    "../images/mazes/space_maze_one_c.png",
  ],
  W2: [
    "../images/mazes/space_maze_two.png",
    "../images/mazes/space_maze_two.png",
    "../images/mazes/space_maze_two.png",
    "../images/mazes/space_maze_two.png",
  ],
  W3: ["../images/mazes/space_maze_three.png"],
  W4: ["../images/mazes/space_maze_four.png"],
  B: [
    "../images/mazes/space_maze_border.png",
    "../images/mazes/space_maze_border.png",
    "../images/mazes/space_maze_border.png",
  ],
  Pl: "../images/heros/pac_hero_droite.png",
  Pr: "../images/heros/pac_hero_droite.png",
};

let Ambiance = Space;

function SetAmbiance(AmbianceName) {
  switch (AmbianceName) {
    case "Jungle":
      Ambiance = Jungle;
    case "Retro":
      Ambiance = Retro;
    case "Space":
      Ambiance = Space;
  }
}

const container = document.getElementById("container");
let rows = document.getElementsByClassName("gridRow");
let cells = document.getElementsByClassName("cell");

var list = [new Garde(0, 0)];

CreateGrid(8, labyrinthe, 14);

function CreateGrid(size, tab, spawnCellId) {
  //#region ROWS
  makeRows(size);
  cellNum = size;
  //#endregion

  //#region CELLS
  for (i = 0; i < rows.length; i++) {
    for (j = 0; j < cellNum; j++) {
      let newCell = document.createElement("td");
      rows[j].appendChild(newCell).className = "cell";

      let newCellp = document.createElement("p");
      newCell.appendChild(newCellp).className = "absolute";
      newCell.id = i + j * cellNum;
      //newCellp.innerHTML = tab[j][i];
      switch (tab[j][i]) {
        case "a":
          AppendImage(Ambiance.W4[0], newCell, "t1");
          break;
        case "b":
          AppendImage(Ambiance.W3[0], newCell, "t2");
          break;
        case "c":
          tmp_img = AppendImage(Ambiance.W3[0], newCell, "t3");
          tmp_img.style.transform = "rotate(90deg)";
          break;
        case "d":
          tmp_img = AppendImage(Ambiance.W3[0], newCell, "t4");
          tmp_img.style.transform = "rotate(180deg)";
          break;
        case "e":
          tmp_img = AppendImage(Ambiance.W3[0], newCell, "t1");
          tmp_img.style.transform = "rotate(-90deg)";
          break;
        case "f":
          R = Math.round(Math.random());
          R1 = Math.round(Math.random());
          if (R) {
            if (R1) {
              tmp_img = AppendImage(Ambiance.W2[0], newCell, "t2");
            } else {
              tmp_img = AppendImage(Ambiance.W2[1], newCell, "t2");
            }
          } else {
            if (R1) {
              tmp_img = AppendImage(Ambiance.W2[2], newCell, "t2");
            } else {
              tmp_img = AppendImage(Ambiance.W2[3], newCell, "t2");
            }
          }
          tmp_img.style.transform = "rotate(90deg)";
          break;
        case "g":
          R = Math.round(Math.random());
          R1 = Math.round(Math.random());
          if (R) {
            if (R1) {
              tmp_img = AppendImage(Ambiance.W2[0], newCell, "t3");
            } else {
              tmp_img = AppendImage(Ambiance.W2[1], newCell, "t3");
            }
          } else {
            if (R1) {
              tmp_img = AppendImage(Ambiance.W2[2], newCell, "t3");
            } else {
              tmp_img = AppendImage(Ambiance.W2[3], newCell, "t3");
            }
          }
          break;
        case "h":
          R = Math.round(Math.random());
          R1 = Math.round(Math.random());
          if (R) {
            if (R1) {
              tmp_img = AppendImage(Ambiance.B[0], newCell, "t4");
            } else {
              tmp_img = AppendImage(Ambiance.B[1], newCell, "t4");
            }
          } else {
            if (R1) {
              tmp_img = AppendImage(Ambiance.B[1], newCell, "t4");
            } else {
              tmp_img = AppendImage(Ambiance.B[2], newCell, "t4");
            }
          }
          tmp_img.style.transform = "rotate(90deg)";
          break;
        case "i":
          R = Math.round(Math.random());
          R1 = Math.round(Math.random());
          if (R) {
            if (R1) {
              tmp_img = AppendImage(Ambiance.B[0], newCell, "t1");
            } else {
              tmp_img = AppendImage(Ambiance.B[1], newCell, "t1");
            }
          } else {
            if (R1) {
              tmp_img = AppendImage(Ambiance.B[1], newCell, "t1");
            } else {
              tmp_img = AppendImage(Ambiance.B[2], newCell, "t1");
            }
          }
          tmp_img.style.transform = "rotate(180deg)";
          break;
        case "j":
          R = Math.round(Math.random());
          R1 = Math.round(Math.random());
          if (R) {
            if (R1) {
              tmp_img = AppendImage(Ambiance.B[0], newCell, "t2");
            } else {
              tmp_img = AppendImage(Ambiance.B[1], newCell, "t2");
            }
          } else {
            if (R1) {
              tmp_img = AppendImage(Ambiance.B[1], newCell, "t2");
            } else {
              tmp_img = AppendImage(Ambiance.B[2], newCell, "t2");
            }
          }
          tmp_img.style.transform = "rotate(-90deg)";
          break;
        case "k":
          R = Math.round(Math.random());
          R1 = Math.round(Math.random());
          if (R) {
            if (R1) {
              tmp_img = AppendImage(Ambiance.B[0], newCell, "t3");
            } else {
              tmp_img = AppendImage(Ambiance.B[1], newCell, "t3");
            }
          } else {
            if (R1) {
              tmp_img = AppendImage(Ambiance.B[1], newCell, "t3");
            } else {
              tmp_img = AppendImage(Ambiance.B[2], newCell, "t3");
            }
          }
          break;
        case "l":
          tmp_img = AppendImage(Ambiance.W1[0], newCell, "t4");
          tmp_img.style.transform = "rotate(180deg)";
          break;
        case "m":
          tmp_img = AppendImage(Ambiance.W1[1], newCell, "t2");
          tmp_img.style.transform = "rotate(-90deg)";
          break;
        case "n":
          tmp_img = AppendImage(Ambiance.W1[2], newCell, "t3");

          break;
        case "o":
          tmp_img = AppendImage(Ambiance.W1[3], newCell, "t4");
          tmp_img.style.transform = "rotate(90deg)";
          break;
      }
    }
  }
  //#endregion

  //#region ANIMATION
  LabAnim("t1");
  LabAnim("t2");
  LabAnim("t3");
  LabAnim("t4");

  //#endregion

  //#region PLAYER
  GenerationGarde(list);
  //#endregion PLAYER

  //#region GARDE

  setTimeout(function () {
    SpawnPlayer(spawnCellId);
  }, 3000);
  //#endregion
}

function SpawnPlayer(cellId) {
  var PlayerPos = cellId;
  var PlayerPosElement = document.getElementById(cellId);
  PlayerPosElement.classList.add("identify");

  const Player = document.createElement("div");
  const PlayerImg = document.createElement("img");
  Player.appendChild(PlayerImg);
  Player.id = "player";
  PlayerImg.id = "playerimg";
  PlayerImg.src = Ambiance.Pl;
  PlayerPosElement.appendChild(Player);

  let box = document.getElementById("1");
  let width = box.offsetWidth;
  let height = box.offsetHeight;

  Player.style.width = width / 2 + "px";
  Player.style.height = height + "px";
  let X = parseFloat(Player.style.width);
  anime({
    targets: "#player",
    translateY: 1000,
    duration: 500,
    easing: "easeInElastic(1, .6)",
    direction: "reverse",
  });
  activate = false;
  document.addEventListener("keydown", function (event) {
    if (activate == false) {
      activate = true;
      let box = document.getElementById("1");
      let width = box.offsetWidth;
      let height = box.offsetHeight;

      anime({
        targets: "#playerimg",
        translateX: [X, -(7.5 * X)],
        easing: "steps(8)",
        duration: 500,
        loop: false,
      });
      MoveGarde(0, 1, -height, 0);
      /* 
      if (event.key == "p") {
        console.log("anime");
        anime({
          targets: [".t1", ".t2", ".t3", ".t4"],
          scale: [
            { value: 0.1, easing: "easeOutSine", duration: 500 },
            { value: 1, easing: "easeInOutQuad", duration: 1200 },
          ],
          delay: anime.stagger(200, { grid: [14, 5], from: "center" }),
        });
      anime({
          targets: [".t1", ".t2", ".t3", ".t4"],
          translateX: anime.stagger(10, {
            grid: [14, 5],
            from: "center",
            axis: "x",
          }),
          translateY: anime.stagger(10, {
            grid: [14, 5],
            from: "center",
            axis: "y",
          }),
          rotateZ: anime.stagger([0, 90], {
            grid: [14, 5],
            from: "center",
            axis: "x",
          }),
          delay: anime.stagger(200, { grid: [14, 5], from: "center" }),
          easing: "easeInOutQuad",
        });
      } */

      if (event.key == "ArrowDown") {
        PHP_Function("../tools/function.php", "Down", function Handle(output) {
          if (output) {
            PlayerPos += cellNum;
            let newPos = document.getElementById(PlayerPos);
            newPos.appendChild(Player);
            PlayerAnim(0, -height);
          }
        });
      }
      if (event.key == "ArrowUp") {
        PHP_Function("../tools/function.php", "Up", function Handle(output) {
          if (output) {
            PlayerPos -= cellNum;
            let newPos = document.getElementById(PlayerPos);
            newPos.appendChild(Player);
            PlayerAnim(0, height);
          }
        });
      }
      if (event.key == "ArrowLeft") {
        PHP_Function("../tools/function.php", "Left", function Handle(output) {
          if (output) {
            PlayerPos -= 1;
            let newPos = document.getElementById(PlayerPos);
            PlayerImg.src = Ambiance.Pl;
            newPos.appendChild(Player);
            PlayerAnim(height, 0);
          }
        });
      }
      if (event.key == "ArrowRight") {
        PHP_Function("../tools/function.php", "Right", function Handle(output) {
          if (output) {
            PlayerPos += 1;
            let newPos = document.getElementById(PlayerPos);
            PlayerImg.src = Ambiance.Pr;
            newPos.appendChild(Player);
            PlayerAnim(-height, 0);
          }
        });
      }
      setTimeout(function () {
        activate = false;
      }, 150);
    }
  });

  anime({
    targets: ".global",
    rotate: anime.stagger([-360, 360]),
    easing: "easeInOutQuad",
    loop: true,
  });
}

function getRandomInt(max) {
  return Math.floor(Math.random() * max);
}

function LabAnim(attClass) {
  anime({
    targets: "." + attClass,
    translateY: getRandomInt(3000) - getRandomInt(1500),
    translateX: getRandomInt(3000) - getRandomInt(1500),
    duration: 2000,
    direction: "reverse",
    easing: "easeInElastic(1, .4)",
    delay: anime.stagger(100, {}),
  });
}

function PlayerAnim(indentX, indentY) {
  anime({
    targets: "#player",
    translateX: indentX,
    translateY: indentY,
    easing: "easeInOutSine",
    direction: "reverse",
    duration: 100,
  });
}

function makeRows(rowNum) {
  for (r = 0; r < rowNum; r++) {
    let row = document.createElement("tr");
    container.appendChild(row).classList.add("gridRow");
    container.appendChild(row).classList.add(r + 1);
  }
}

function AppendImage(mediaPath, cell, speClass) {
  cell.classList.add(speClass);
  let newImg = document.createElement("img");
  newImg.classList.add("walls");
  newImg.src = mediaPath;
  cell.appendChild(newImg);
  return newImg;
}

function PHP_Function(fileName, functionName, Awaiting, Arguments) {
  $.ajax({
    type: "POST",
    url: fileName,
    async: false,
    data: {
      functionName: functionName,
      functionParameters: Arguments,
    },
    success: function (data) {
      Awaiting(data);
      console.log(data);
      return data;
    },
    error: function (data) {
      console.error(data);
      return data;
    },
  });
}

function Garde(id, pos) {
  this.id = id;
  this.pos = pos;
}

function GenerationGarde(gardeList) {
  var ListGarde = [];
  for (i = 0; i < gardeList.length; i++) {
    ListGarde.push(Garde(gardeList[i].id, gardeList[i].pos));
  }

  for (i = 0; i < gardeList.length; i++) {
    var Cell = document.getElementById(gardeList[i].pos);
    const GardeDiv = document.createElement("div");
    const GardeImg = document.createElement("img");
    Cell.appendChild(GardeDiv);
    let box = document.getElementById("1");

    let width = box.offsetWidth;
    let height = box.offsetHeight;
    GardeDiv.style.width = width / 2 + "px";
    GardeDiv.style.height = height + "px";
    GardeDiv.classList.add("Garde");
    GardeDiv.id = "G_div" + gardeList[i].id;
    GardeDiv.classList.add("Garde");
    GardeImg.classList.add("GardeImg");
    GardeImg.id = "G_ui" + gardeList[i].id;
    GardeImg.src = "../images/gardes/jungle_guard_droite_sprite.png";
    GardeDiv.appendChild(GardeImg);
    anime({
      targets: "#G_div" + gardeList[i].id,
      translateY: getRandomInt(3000) - getRandomInt(1500),
      translateX: getRandomInt(3000) - getRandomInt(1500),
      duration: 2000,
      direction: "reverse",
      easing: "easeInElastic(1, .7)",
      delay: anime.stagger(100, {}),
    });
  }
}

function MoveGarde(gardeId, posIndent, indentX, indentY) {
  let X;
  let box = document.getElementById("1");
  let width = box.offsetWidth;
  let height = box.offsetHeight;
  let GardeImg = document.getElementById("G_ui" + gardeId);

  for (i = 0; i < list.length; i++) {
    if (list[i].id == gardeId) {
      list[i].pos += posIndent;
      let newCell = document.getElementById(list[i].pos);
      let Garde = document.getElementById("G_div" + list[i].id);
      newCell.appendChild(Garde);
      Garde.style.width = width / 2 + "px";
      Garde.style.height = height + "px";
    }
  }

  let W = GardeImg.width;

  anime({
    targets: "#G_div" + gardeId,
    translateX: indentX,
    translateY: indentY,
    easing: "easeInOutSine",
    direction: "reverse",
    duration: 150,
  });
}

Solveur([1, 2, 3]);

function Solveur(tab) {
  for (i = 0; i < tab.length; i++) {
    let Cell = document.getElementById(tab[i]);
    const Div = document.createElement("div");

    let box = document.getElementById("1");
    let width = box.offsetWidth;
    let height = box.offsetHeight;

    Div.style.width = width + "px";
    Div.style.height = height + "px";

    const Img = document.createElement("img");

    Cell.appendChild(Div);
    Div.appendChild(Img);

    Div.classList.add("solveur");
    Img.classList.add("solveur");

    Img.src = "../images/solveur/point.png";
  }
}
